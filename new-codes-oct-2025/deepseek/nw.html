<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>✨ Marathi Marriage Biodata Studio</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== CODE PROTECTION ===== */
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }
    body * {
      -webkit-user-select: none !important;
      user-select: none !important;
    }

    /* ===== VARIABLES ===== */
    :root {
      --primary: #FF6B35;
      --secondary: #F7931E;
      --accent: #FFD166;
      --dark-bg: #121212;
      --light-bg: #f8f9fa;
      --card-bg-dark: rgba(30, 30, 30, 0.7);
      --card-bg-light: rgba(255, 255, 255, 0.8);
      --text-dark: #212529;
      --text-light: #f8f9fa;
      --border-radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.3);
      --transition: all 0.3s ease;
    }

    /* ===== BASE ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: var(--text-light);
      min-height: 100vh;
      padding: 20px;
      transition: var(--transition);
    }

    body.light-mode {
      background: linear-gradient(135deg, #f5f7fa, #e4edf9);
      color: var(--text-dark);
    }

    /* ===== THEME TOGGLE ===== */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.1);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      backdrop-filter: blur(10px);
      color: white;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: var(--transition);
    }
    .theme-toggle:hover {
      background: rgba(255,255,255,0.2);
    }
    .theme-label {
      position: absolute;
      top: 60px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.85rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    .theme-toggle:hover + .theme-label {
      opacity: 1;
    }

    /* ===== CONTAINER ===== */
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .hero {
      text-align: center;
      margin-bottom: 30px;
    }
    .hero h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    /* ===== PANELS ===== */
    .panel {
      border-radius: var(--border-radius);
      padding: 25px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    body.dark-mode .panel {
      background: var(--card-bg-dark);
      border: 1px solid rgba(255,255,255,0.1);
    }

    body.light-mode .panel {
      background: var(--card-bg-light);
      border: 1px solid rgba(0,0,0,0.1);
    }

    /* ===== FORM STYLES ===== */
    input, select, textarea, button {
      width: 100%;
      padding: 12px 16px;
      margin: 8px 0;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.2);
      color: white;
      font-family: inherit;
      font-size: 1rem;
      transition: var(--transition);
    }

    body.light-mode input,
    body.light-mode select,
    body.light-mode textarea {
      background: white;
      color: var(--text-dark);
      border: 1px solid #ddd;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(247, 147, 30, 0.3);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0 10px;
      cursor: pointer;
      padding: 10px;
      border-radius: 10px;
      transition: var(--transition);
    }
    .section-header:hover {
      background: rgba(255,255,255,0.05);
    }
    .section-header h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.2rem;
    }
    .section-header i.chevron {
      transition: transform 0.3s;
    }
    .section-content {
      display: none;
    }
    .section-content.active {
      display: block;
    }

    /* ===== BUTTONS ===== */
    .btn {
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: var(--transition);
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
    }
    .btn-success {
      background: linear-gradient(90deg, #25D366, #128C7E);
      color: white;
    }
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    }
    .btn-outline {
      background: transparent;
      border: 2px solid var(--secondary);
      color: var(--secondary);
    }
    .btn-small {
      padding: 8px 12px;
      font-size: 0.85rem;
    }

    /* ===== PHOTO UPLOAD ===== */
    .photo-upload {
      text-align: center;
    }
    .upload-btn {
      display: inline-block;
      padding: 12px 24px;
      background: rgba(255,255,255,0.1);
      border: 2px dashed var(--accent);
      border-radius: 12px;
      cursor: pointer;
      transition: var(--transition);
    }
    .photo-preview {
      width: 120px;
      height: 120px;
      margin: 15px auto;
      border-radius: 50%;
      overflow: hidden;
      background: rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.5);
    }
    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .god-image-preview {
      width: 80px;
      height: 80px;
      margin: 10px auto;
      overflow: hidden;
      background: rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.5);
    }
    .god-image-preview img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* ===== MODAL STYLES ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-bg-dark);
      border-radius: 20px;
      padding: 30px;
      max-width: 95vw;
      max-height: 95vh;
      overflow: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    body.light-mode .modal-content {
      background: white;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      width: auto;
      padding: 5px;
    }

    body.light-mode .modal-close {
      color: var(--text-dark);
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .modal-actions .btn {
      flex: 1;
      min-width: 140px;
    }

    /* ===== PREVIEW ===== */
    .a4-page {
      width: 210mm;
      min-height: 297mm;
      background: #1e1e1e;
      color: white;
      padding: 20mm;
      margin: 0 auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      position: relative;
      font-size: 13px;
      line-height: 1.5;
      font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif;
      overflow: hidden;
    }
    body.light-mode .a4-page {
      background: white;
      color: black;
    }

    .religious-header {
      text-align: center;
      margin-bottom: 15px;
      color: var(--accent);
      font-size: 1.1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .god-image {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }

    .biodata-name {
      text-align: center;
      font-size: 1.6rem;
      margin-bottom: 20px;
      font-weight: 600;
      color: var(--secondary);
    }

    .info-item {
      margin: 8px 0;
    }
    .info-label {
      font-weight: 600;
      color: var(--secondary);
      display: inline-block;
      width: 180px;
      vertical-align: top;
    }
    .info-value {
      display: inline-block;
      width: calc(100% - 190px);
      vertical-align: top;
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
      margin: 15px 0 8px;
      padding-bottom: 4px;
      border-bottom: 2px solid var(--accent);
    }

    /* ===== WATERMARK ===== */
    .watermark {
      position: absolute;
      bottom: 15mm;
      right: 20mm;
      font-size: 10px;
      color: rgba(255,255,255,0.3);
      font-family: 'Poppins', sans-serif;
      pointer-events: none;
      z-index: 10;
    }

    body.light-mode .watermark {
      color: rgba(0,0,0,0.3);
    }

    .watermark a {
      color: inherit;
      text-decoration: none;
      pointer-events: auto;
    }

    .watermark a:hover {
      color: var(--accent);
    }

    /* ===== TOAST NOTIFICATION ===== */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* ===== FORM GRID ===== */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* ===== CUSTOM FIELDS ===== */
    .custom-field {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .custom-field input {
      margin: 0;
    }
    .remove-field {
      background: #ff4757;
      color: white;
      border: none;
      border-radius: 8px;
      width: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .add-field-btn {
      background: var(--accent);
      color: #333;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      margin: 10px 0;
    }

    .sibling-item, .relative-item {
      display: flex;
      gap: 10px;
      margin: 8px 0;
      align-items: center;
    }

    .sibling-item input, .relative-item input {
      margin: 0;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .a4-page {
        width: 100%;
        padding: 10mm;
        transform: scale(0.9);
        transform-origin: top center;
        margin: 0 auto;
        min-height: auto;
      }
      
      .modal-content {
        width: 95%;
        padding: 15px;
      }
      
      .modal-actions {
        flex-direction: column;
      }
      .form-grid { grid-template-columns: 1fr; }
      .custom-field { flex-direction: column; }
      .sibling-item, .relative-item { flex-direction: column; }
      .info-label {
        width: 120px;
      }
      .info-value {
        width: calc(100% - 130px);
      }
    }

    @media (max-width: 480px) {
      .a4-page {
        transform: scale(0.8);
      }
      .info-label {
        width: 100px;
      }
      .info-value {
        width: calc(100% - 110px);
      }
    }

    /* ===== PHOTO SHAPE SELECTOR ===== */
    .photo-shape-selector {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      justify-content: center;
    }
    .shape-option {
      padding: 8px 12px;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      background: rgba(255,255,255,0.1);
    }
    .shape-option.active {
      border-color: var(--secondary);
      background: rgba(247, 147, 30, 0.1);
    }
    .photo-preview.rectangular {
      border-radius: 12px;
    }
    .photo-preview.original {
      border-radius: 0;
    }

    /* ===== PHOTO SIZE SELECTOR ===== */
    .photo-size-selector {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      justify-content: center;
    }
    .size-option {
      padding: 6px 10px;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
      background: rgba(255,255,255,0.1);
      font-size: 0.8rem;
    }
    .size-option.active {
      border-color: var(--secondary);
      background: rgba(247, 147, 30, 0.1);
    }
  </style>
</head>
<body class="dark-mode" oncontextmenu="return false;">
  <!-- Theme Toggle -->
  <button class="theme-toggle" id="theme-toggle">
    <i class="fas fa-moon"></i>
  </button>
  <div class="theme-label">Toggle Theme</div>

  <div class="container">
    <header class="hero">
      <h1>✨ Marathi Marriage Biodata Studio</h1>
      <p>Create stunning, traditional biodata in seconds</p>
    </header>

    <main>
      <!-- Form Panel -->
      <section class="panel" id="form-panel">
        <h2><i class="fas fa-user-edit"></i> Your Details</h2>

        <form id="biodata-form">
          <!-- Gender Selection -->
          <div class="form-group">
            <label for="gender">Gender</label>
            <select id="gender" name="gender">
              <option value="female">Female (कुमारी)</option>
              <option value="male">Male (कुमार)</option>
            </select>
          </div>

          <!-- Religious Header Customization -->
          <div class="section-header" data-section="religious">
            <h3><i class="fas fa-pray"></i> Religious Header</h3>
            <i class="fas fa-chevron-down chevron"></i>
          </div>
          <div class="section-content active" id="religious-content">
            <input type="text" id="religious-text" placeholder="Religious Text" value="श्री गणेशाय नमः | जय श्री राम">
            
            <!-- God Image Upload -->
            <div class="photo-upload">
              <input type="file" id="god-image" accept="image/*" hidden />
              <label for="god-image" class="upload-btn">
                <i class="fas fa-cloud-upload-alt"></i> Upload God Image
              </label>
              <div class="god-image-preview" id="god-image-preview">
                <span id="no-god-image">No image</span>
              </div>
            </div>
          </div>

          <!-- Personal Info (Visible by default) -->
          <div class="section-header" data-section="personal">
            <h3><i class="fas fa-user"></i> Personal Information</h3>
            <i class="fas fa-chevron-down chevron"></i>
          </div>
          <div class="section-content active" id="personal-content">
            <input type="text" id="name" placeholder="Full Name (e.g., मानिका अभिमन्यू पाटील)" />
            <div class="form-grid">
              <input type="date" id="dob" />
              <input type="time" id="birth-time" />
            </div>
            <input type="text" id="birth-place" placeholder="जन्म ठिकाण (e.g., अमरावती)" />
            <div class="form-grid">
              <input type="text" id="height" placeholder="उंची (e.g., 5'5\")" />
              <input type="text" id="blood-group" placeholder="रक्त गट (e.g., O+)" />
            </div>
            <div class="form-grid">
              <input type="text" id="weight" placeholder="वजन (e.g., 55 kg)" />
              <input type="text" id="complexion" placeholder="वर्ण (e.g., गोरा)" />
            </div>
            <div class="form-grid">
              <input type="text" id="religion-caste" placeholder="धर्म, जात (e.g., हिंदू, मराठा)" />
              <input type="text" id="education" placeholder="शिक्षण (e.g., B.E. Computer Science)" />
            </div>
            <input type="text" id="profession" placeholder="व्यवसाय (e.g., Software Engineer)" />
            <input type="text" id="income" placeholder="वार्षिक उत्पन्न (e.g., 8 लाख)" />
            
            <!-- Horoscope Details inside Personal Information -->
            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed rgba(255,255,255,0.2);">
              <h4 style="color: var(--accent); margin-bottom: 8px;"><i class="fas fa-star"></i> Horoscope Details</h4>
              <div class="form-grid">
                <input type="text" id="rashi" placeholder="राशी (e.g., मिथुन)" />
                <input type="text" id="nakshatra" placeholder="नक्षत्र (e.g., आर्द्रा)" />
              </div>
              <div class="form-grid">
                <input type="text" id="gan" placeholder="गण (e.g., मनुष्य)" />
                <input type="text" id="mangalik" placeholder="मंगळिक (e.g., होय/नाही)" />
              </div>
            </div>
            
            <button type="button" class="add-field-btn" data-section="personal">
              <i class="fas fa-plus"></i> Add Custom Field
            </button>
            <div id="personal-custom-fields"></div>
          </div>

          <!-- Family (Collapsed by default) -->
          <div class="section-header" data-section="family">
            <h3><i class="fas fa-home"></i> Family Details</h3>
            <i class="fas fa-chevron-right chevron"></i>
          </div>
          <div class="section-content" id="family-content">
            <input type="text" id="father-name" placeholder="वडिलांचे नाव" />
            <input type="text" id="father-occupation" placeholder="वडिलांचा व्यवसाय" />
            <input type="text" id="father-mobile" placeholder="वडिलांचा मोबाईल क्रमांक" />
            <input type="text" id="mother-name" placeholder="आईचे नाव" />
            <input type="text" id="mother-occupation" placeholder="आईचा व्यवसाय" />
            <input type="text" id="grandfather" placeholder="आजोबा" />
            <input type="text" id="grandmother" placeholder="आजी" />
            
            <!-- Bhau Section -->
            <div style="margin-top: 15px;">
              <h4 style="color: var(--accent); margin-bottom: 8px;">भाऊ (Brothers)</h4>
              <div id="bhau-container">
                <div class="sibling-item">
                  <input type="text" placeholder="भाऊचे नाव" class="bhau-name">
                  <input type="text" placeholder="वय आणि तपशील" class="bhau-details">
                  <button type="button" class="remove-field" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <button type="button" class="add-field-btn" onclick="addSibling('bhau')">
                <i class="fas fa-plus"></i> Add Bhau
              </button>
            </div>
            
            <!-- Bahin Section -->
            <div style="margin-top: 15px;">
              <h4 style="color: var(--accent); margin-bottom: 8px;">बहीण (Sisters)</h4>
              <div id="bahin-container">
                <div class="sibling-item">
                  <input type="text" placeholder="बहिणीचे नाव" class="bahin-name">
                  <input type="text" placeholder="वय आणि तपशील" class="bahin-details">
                  <button type="button" class="remove-field" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <button type="button" class="add-field-btn" onclick="addSibling('bahin')">
                <i class="fas fa-plus"></i> Add Bahin
              </button>
            </div>
            
            <!-- Kaka Section -->
            <div style="margin-top: 15px;">
              <h4 style="color: var(--accent); margin-bottom: 8px;">काका (Uncles)</h4>
              <div id="kaka-container">
                <div class="relative-item">
                  <input type="text" placeholder="काकांचे नाव" class="kaka-name">
                  <input type="text" placeholder="संपर्क क्रमांक" class="kaka-contact">
                  <button type="button" class="remove-field" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <button type="button" class="add-field-btn" onclick="addRelative('kaka')">
                <i class="fas fa-plus"></i> Add Kaka
              </button>
            </div>
            
            <!-- Mama Section -->
            <div style="margin-top: 15px;">
              <h4 style="color: var(--accent); margin-bottom: 8px;">मामा (Maternal Uncles)</h4>
              <div id="mama-container">
                <div class="relative-item">
                  <input type="text" placeholder="मामांचे नाव" class="mama-name">
                  <input type="text" placeholder="संपर्क क्रमांक" class="mama-contact">
                  <button type="button" class="remove-field" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <button type="button" class="add-field-btn" onclick="addRelative('mama')">
                <i class="fas fa-plus"></i> Add Mama
              </button>
            </div>
            
            <button type="button" class="add-field-btn" data-section="family">
              <i class="fas fa-plus"></i> Add Custom Field
            </button>
            <div id="family-custom-fields"></div>
          </div>

          <!-- Relatives Section -->
          <div class="section-header" data-section="relatives">
            <h3><i class="fas fa-users"></i> Relatives Surnames</h3>
            <i class="fas fa-chevron-right chevron"></i>
          </div>
          <div class="section-content" id="relatives-content">
            <div style="margin-top: 10px;">
              <h4 style="color: var(--accent); margin-bottom: 8px;">संबंधित आडनावे</h4>
              <input type="text" id="surnames" placeholder="आडनावे (comma separated, e.g., पाटील, जाधव, शिंदे)" />
            </div>
          </div>

          <!-- Contact Information -->
          <div class="section-header" data-section="contact">
            <h3><i class="fas fa-address-card"></i> Contact Information</h3>
            <i class="fas fa-chevron-right chevron"></i>
          </div>
          <div class="section-content" id="contact-content">
            <input type="text" id="phone" placeholder="मोबाईल क्रमांक" />
            <input type="email" id="email" placeholder="ईमेल" />
            <textarea id="address" placeholder="पत्ता" rows="2"></textarea>
            
            <button type="button" class="add-field-btn" data-section="contact">
              <i class="fas fa-plus"></i> Add Custom Field
            </button>
            <div id="contact-custom-fields"></div>
          </div>

          <!-- Expectations -->
          <div class="section-header" data-section="expectations">
            <h3><i class="fas fa-heart"></i> Partner Expectations</h3>
            <i class="fas fa-chevron-right chevron"></i>
          </div>
          <div class="section-content" id="expectations-content">
            <textarea id="expectations" placeholder="वराच्या अपेक्षा" rows="2"></textarea>
            <textarea id="hobbies" placeholder="आवडी/हौबी" rows="2"></textarea>
            
            <button type="button" class="add-field-btn" data-section="expectations">
              <i class="fas fa-plus"></i> Add Custom Field
            </button>
            <div id="expectations-custom-fields"></div>
          </div>

          <!-- Photo (Collapsed by default) -->
          <div class="section-header" data-section="photo">
            <h3><i class="fas fa-camera"></i> Profile Photo</h3>
            <i class="fas fa-chevron-right chevron"></i>
          </div>
          <div class="section-content" id="photo-content">
            <div class="photo-upload">
              <input type="file" id="profile-pic" accept="image/*" hidden />
              <label for="profile-pic" class="upload-btn">
                <i class="fas fa-cloud-upload-alt"></i> Upload Photo
              </label>
              
              <div class="photo-shape-selector">
                <div class="shape-option active" data-shape="circular">
                  <i class="fas fa-circle"></i> Circular
                </div>
                <div class="shape-option" data-shape="rectangular">
                  <i class="fas fa-square"></i> Rectangular
                </div>
                <div class="shape-option" data-shape="original">
                  <i class="fas fa-image"></i> Original
                </div>
              </div>

              <div class="photo-size-selector">
                <div class="size-option active" data-size="small">
                  <i class="fas fa-compress-alt"></i> Small
                </div>
                <div class="size-option" data-size="medium">
                  <i class="fas fa-expand-alt"></i> Medium
                </div>
                <div class="size-option" data-size="large">
                  <i class="fas fa-expand"></i> Large
                </div>
              </div>
              
              <div class="photo-preview circular" id="photo-preview">
                <span id="no-photo">No photo</span>
              </div>
            </div>
          </div>

          <button type="button" id="preview-btn" class="btn btn-primary">
            <i class="fas fa-eye"></i> Preview Biodata
          </button>
        </form>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="preview-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Your Biodata Preview</h2>
        <button class="modal-close" id="modal-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="a4-page" id="biodata-preview">
        <div class="watermark">
          <a href="https://creativebiodata.com" target="_blank">creativebiodata.com</a>
        </div>
        <div class="religious-header">
          <div id="god-image-preview-preview"></div>
          <div id="religious-text-preview">श्री गणेशाय नमः | जय श्री राम</div>
        </div>
        <div class="biodata-name">Your biodata will appear here</div>
      </div>
      
      <div class="modal-actions">
        <button id="share-whatsapp" class="btn btn-success">
          <i class="fab fa-whatsapp"></i> Share on WhatsApp
        </button>
        <button id="download-image" class="btn btn-outline">
          <i class="fas fa-image"></i> Download PNG
        </button>
        <button id="download-pdf" class="btn btn-outline">
          <i class="fas fa-file-pdf"></i> Download PDF
        </button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // === CODE PROTECTION ===
    document.addEventListener('keydown', (e) => {
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && e.key === 'I') ||
          (e.ctrlKey && e.shiftKey && e.key === 'J') ||
          (e.ctrlKey && e.key === 'u')) {
        e.preventDefault();
        showToast('This action is disabled');
        return false;
      }
    });

    // === TOAST NOTIFICATION ===
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // === THEME TOGGLE ===
    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      const icon = document.querySelector('#theme-toggle i');
      icon.className = document.body.classList.contains('light-mode') 
        ? 'fas fa-sun' 
        : 'fas fa-moon';
    });

    // === MODAL FUNCTIONALITY ===
    const modal = document.getElementById('preview-modal');
    const previewBtn = document.getElementById('preview-btn');
    const modalClose = document.getElementById('modal-close');

    previewBtn.addEventListener('click', () => {
      generateBiodata();
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    });

    modalClose.addEventListener('click', () => {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });

    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });

    // === COLLAPSIBLE SECTIONS ===
    document.querySelectorAll('.section-header').forEach(header => {
      header.addEventListener('click', () => {
        const sectionId = header.getAttribute('data-section');
        const content = document.getElementById(`${sectionId}-content`);
        const chevron = header.querySelector('.chevron');
        
        content.classList.toggle('active');
        if (content.classList.contains('active')) {
          chevron.className = 'fas fa-chevron-down chevron';
        } else {
          chevron.className = 'fas fa-chevron-right chevron';
        }
      });
    });

    // === PHOTO SHAPE SELECTOR ===
    let selectedShape = 'circular';
    document.querySelectorAll('.shape-option').forEach(option => {
      option.addEventListener('click', (e) => {
        document.querySelectorAll('.shape-option').forEach(opt => {
          opt.classList.remove('active');
        });
        e.target.classList.add('active');
        selectedShape = e.target.getAttribute('data-shape');
        
        const preview = document.getElementById('photo-preview');
        preview.className = `photo-preview ${selectedShape}`;
      });
    });

    // === PHOTO SIZE SELECTOR ===
    let selectedSize = 'small';
    document.querySelectorAll('.size-option').forEach(option => {
      option.addEventListener('click', (e) => {
        document.querySelectorAll('.size-option').forEach(opt => {
          opt.classList.remove('active');
        });
        e.target.classList.add('active');
        selectedSize = e.target.getAttribute('data-size');
      });
    });

    // === CUSTOM FIELDS ===
    document.querySelectorAll('.add-field-btn').forEach(button => {
      button.addEventListener('click', (e) => {
        const section = e.target.getAttribute('data-section');
        const container = document.getElementById(`${section}-custom-fields`);
        
        const fieldId = `custom-${section}-${Date.now()}`;
        const fieldHTML = `
          <div class="custom-field" id="${fieldId}">
            <input type="text" placeholder="Field Name" class="custom-field-name">
            <input type="text" placeholder="Field Value" class="custom-field-value">
            <button type="button" class="remove-field" onclick="document.getElementById('${fieldId}').remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
        
        container.insertAdjacentHTML('beforeend', fieldHTML);
      });
    });

    // === SIBLINGS AND RELATIVES MANAGEMENT ===
    function addSibling(type) {
      const container = document.getElementById(`${type}-container`);
      const siblingHTML = `
        <div class="sibling-item">
          <input type="text" placeholder="${type === 'bhau' ? 'भाऊचे नाव' : 'बहिणीचे नाव'}" class="${type}-name">
          <input type="text" placeholder="वय आणि तपशील" class="${type}-details">
          <button type="button" class="remove-field" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      container.insertAdjacentHTML('beforeend', siblingHTML);
    }

    function addRelative(type) {
      const container = document.getElementById(`${type}-container`);
      const relativeHTML = `
        <div class="relative-item">
          <input type="text" placeholder="${type === 'kaka' ? 'काकांचे नाव' : 'मामांचे नाव'}" class="${type}-name">
          <input type="text" placeholder="संपर्क क्रमांक" class="${type}-contact">
          <button type="button" class="remove-field" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      container.insertAdjacentHTML('beforeend', relativeHTML);
    }

    // === IMAGE UPLOADS ===
    let currentPhotoURL = null;
    let currentGodImageURL = null;
    
    // Profile Photo
    const photoInput = document.getElementById('profile-pic');
    const photoPreview = document.getElementById('photo-preview');
    const noPhoto = document.getElementById('no-photo');

    photoInput.addEventListener('change', (e) => {
      if (e.target.files[0]) {
        // Revoke previous URL to prevent memory leaks
        if (currentPhotoURL) {
          URL.revokeObjectURL(currentPhotoURL);
        }
        currentPhotoURL = URL.createObjectURL(e.target.files[0]);
        noPhoto.style.display = 'none';
        photoPreview.innerHTML = `<img src="${currentPhotoURL}" alt="Profile Photo">`;
        showToast('Profile photo uploaded successfully');
      }
    });

    // God Image
    const godImageInput = document.getElementById('god-image');
    const godImagePreview = document.getElementById('god-image-preview');
    const noGodImage = document.getElementById('no-god-image');

    godImageInput.addEventListener('change', (e) => {
      if (e.target.files[0]) {
        // Revoke previous URL to prevent memory leaks
        if (currentGodImageURL) {
          URL.revokeObjectURL(currentGodImageURL);
        }
        currentGodImageURL = URL.createObjectURL(e.target.files[0]);
        noGodImage.style.display = 'none';
        godImagePreview.innerHTML = `<img src="${currentGodImageURL}" alt="God Image">`;
        showToast('God image uploaded successfully');
      }
    });

    // === GENERATE BIODATA ===
    function generateBiodata() {
      const gender = document.getElementById('gender').value;
      const genderPrefix = gender === 'female' ? 'कु.' : 'कु.';
      const religiousText = document.getElementById('religious-text').value;
      
      // Collect standard form data
      const data = {
        gender: gender,
        name: document.getElementById('name').value,
        dob: document.getElementById('dob').value,
        birthTime: document.getElementById('birth-time').value,
        birthPlace: document.getElementById('birth-place').value,
        height: document.getElementById('height').value,
        weight: document.getElementById('weight').value,
        complexion: document.getElementById('complexion').value,
        bloodGroup: document.getElementById('blood-group').value,
        religionCaste: document.getElementById('religion-caste').value,
        education: document.getElementById('education').value,
        profession: document.getElementById('profession').value,
        income: document.getElementById('income').value,
        fatherName: document.getElementById('father-name').value,
        fatherOccupation: document.getElementById('father-occupation').value,
        fatherMobile: document.getElementById('father-mobile').value,
        motherName: document.getElementById('mother-name').value,
        motherOccupation: document.getElementById('mother-occupation').value,
        grandfather: document.getElementById('grandfather').value,
        grandmother: document.getElementById('grandmother').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        address: document.getElementById('address').value,
        hobbies: document.getElementById('hobbies').value,
        expectations: document.getElementById('expectations').value,
        rashi: document.getElementById('rashi').value,
        nakshatra: document.getElementById('nakshatra').value,
        gan: document.getElementById('gan').value,
        mangalik: document.getElementById('mangalik').value,
        surnames: document.getElementById('surnames').value
      };

      // Collect siblings and relatives
      const siblings = {
        bhau: collectSiblings('bhau'),
        bahin: collectSiblings('bahin')
      };

      const relatives = {
        kaka: collectRelatives('kaka'),
        mama: collectRelatives('mama')
      };

      // Collect custom fields
      const customFields = {
        personal: collectCustomFields('personal'),
        family: collectCustomFields('family'),
        contact: collectCustomFields('contact'),
        expectations: collectCustomFields('expectations')
      };

      const hasPhoto = currentPhotoURL !== null;
      const hasGodImage = currentGodImageURL !== null;

      // Build biodata HTML with compact layout
      let html = `
        <div class="religious-header">
          ${hasGodImage ? `<img src="${currentGodImageURL}" class="god-image" alt="God Image">` : ''}
          <div>${religiousText}</div>
        </div>
        
        <div class="biodata-name">${genderPrefix} ${data.name || 'नाव'}</div>
      `;

      // Personal Information Section (including Horoscope)
      if (hasValue(data.dob) || hasValue(data.birthTime) || hasValue(data.birthPlace) || 
          hasValue(data.height) || hasValue(data.weight) || hasValue(data.complexion) || 
          hasValue(data.bloodGroup) || hasValue(data.religionCaste) || hasValue(data.education) || 
          hasValue(data.profession) || hasValue(data.income) || hasValue(data.rashi) || 
          hasValue(data.nakshatra) || hasValue(data.gan) || hasValue(data.mangalik) || 
          customFields.personal.length > 0) {
        
        html += `<div class="section-title">वैयक्तिक माहिती</div>`;
        
        // Add profile photo with proper styling and size
        if (hasPhoto) {
          const sizeStyle = selectedSize === 'small' ? 
            'width:80px;height:80px;' : 
            selectedSize === 'medium' ? 
            'width:100px;height:100px;' : 
            'width:120px;height:120px;';
            
          const shapeStyle = selectedShape === 'circular' ? 
            'border-radius:50%;' :
            selectedShape === 'rectangular' ?
            'border-radius:8px;' :
            'border-radius:0;';
          
          const photoStyle = `${sizeStyle} ${shapeStyle} object-fit:cover;float:right;margin:0 0 10px 10px;border:2px solid white;`;
          
          html += `<img src="${currentPhotoURL}" style="${photoStyle}">`;
        }
        
        // Date and time combined
        if (hasValue(data.dob) || hasValue(data.birthTime)) {
          const dateStr = formatDate(data.dob);
          const timeStr = formatTime(data.birthTime);
          const dateTimeStr = [dateStr, timeStr].filter(Boolean).join(', ');
          html += `<div class="info-item"><span class="info-label">जन्म तारीख, वेळ:</span> <span class="info-value">${dateTimeStr}</span></div>`;
        }
        
        html += buildInfoItems([
          { label: 'जन्म ठिकाण', value: data.birthPlace },
          { label: 'उंची', value: data.height },
          { label: 'वजन', value: data.weight },
          { label: 'वर्ण', value: data.complexion },
          { label: 'रक्त गट', value: data.bloodGroup },
          { label: 'धर्म, जात', value: data.religionCaste },
          { label: 'शिक्षण', value: data.education },
          { label: 'व्यवसाय', value: data.profession },
          { label: 'वार्षिक उत्पन्न', value: data.income },
          { label: 'राशी', value: data.rashi },
          { label: 'नक्षत्र', value: data.nakshatra },
          { label: 'गण', value: data.gan },
          { label: 'मंगळिक', value: data.mangalik }
        ]);
        
        // Add custom personal fields
        customFields.personal.forEach(field => {
          html += `<div class="info-item"><span class="info-label">${field.name}:</span> <span class="info-value">${field.value}</span></div>`;
        });
      }

      // Family Information Section
      if (hasValue(data.fatherName) || hasValue(data.fatherOccupation) || hasValue(data.fatherMobile) || 
          hasValue(data.motherName) || hasValue(data.motherOccupation) || hasValue(data.grandfather) || 
          hasValue(data.grandmother) || siblings.bhau.length > 0 || siblings.bahin.length > 0 || 
          relatives.kaka.length > 0 || relatives.mama.length > 0 || customFields.family.length > 0) {
        
        html += `<div class="section-title">कौटुंबिक माहिती</div>`;
        html += buildInfoItems([
          { label: 'वडिलांचे नाव', value: data.fatherName },
          { label: 'वडिलांचा व्यवसाय', value: data.fatherOccupation },
          { label: 'वडिलांचा मोबाईल', value: data.fatherMobile },
          { label: 'आईचे नाव', value: data.motherName },
          { label: 'आईचा व्यवसाय', value: data.motherOccupation },
          { label: 'आजोबा', value: data.grandfather },
          { label: 'आजी', value: data.grandmother }
        ]);
        
        // Bhau section - separate lines for multiple items
        if (siblings.bhau.length > 0) {
          if (siblings.bhau.length === 1) {
            const bhau = siblings.bhau[0];
            html += `<div class="info-item"><span class="info-label">भाऊ:</span> <span class="info-value">${bhau.name}${bhau.details ? ` (${bhau.details})` : ''}</span></div>`;
          } else {
            html += `<div class="info-item"><span class="info-label">भाऊ:</span> <span class="info-value">`;
            siblings.bhau.forEach((bhau, index) => {
              html += `${index + 1}. ${bhau.name}${bhau.details ? ` (${bhau.details})` : ''}<br>`;
            });
            html += `</span></div>`;
          }
        }
        
        // Bahin section - separate lines for multiple items
        if (siblings.bahin.length > 0) {
          const label = siblings.bahin.length === 1 ? 'बहीण' : 'बहिणी';
          if (siblings.bahin.length === 1) {
            const bahin = siblings.bahin[0];
            html += `<div class="info-item"><span class="info-label">${label}:</span> <span class="info-value">${bahin.name}${bahin.details ? ` (${bahin.details})` : ''}</span></div>`;
          } else {
            html += `<div class="info-item"><span class="info-label">${label}:</span> <span class="info-value">`;
            siblings.bahin.forEach((bahin, index) => {
              html += `${index + 1}. ${bahin.name}${bahin.details ? ` (${bahin.details})` : ''}<br>`;
            });
            html += `</span></div>`;
          }
        }
        
        // Kaka section - separate lines for multiple items
        if (relatives.kaka.length > 0) {
          if (relatives.kaka.length === 1) {
            const kaka = relatives.kaka[0];
            html += `<div class="info-item"><span class="info-label">काका:</span> <span class="info-value">${kaka.name}${kaka.contact ? ` - ${kaka.contact}` : ''}</span></div>`;
          } else {
            html += `<div class="info-item"><span class="info-label">काका:</span> <span class="info-value">`;
            relatives.kaka.forEach((kaka, index) => {
              html += `${index + 1}. ${kaka.name}${kaka.contact ? ` - ${kaka.contact}` : ''}<br>`;
            });
            html += `</span></div>`;
          }
        }
        
        // Mama section - separate lines for multiple items
        if (relatives.mama.length > 0) {
          if (relatives.mama.length === 1) {
            const mama = relatives.mama[0];
            html += `<div class="info-item"><span class="info-label">मामा:</span> <span class="info-value">${mama.name}${mama.contact ? ` - ${mama.contact}` : ''}</span></div>`;
          } else {
            html += `<div class="info-item"><span class="info-label">मामा:</span> <span class="info-value">`;
            relatives.mama.forEach((mama, index) => {
              html += `${index + 1}. ${mama.name}${mama.contact ? ` - ${mama.contact}` : ''}<br>`;
            });
            html += `</span></div>`;
          }
        }
        
        // Add custom family fields
        customFields.family.forEach(field => {
          html += `<div class="info-item"><span class="info-label">${field.name}:</span> <span class="info-value">${field.value}</span></div>`;
        });
      }

      // Relatives Surnames Section
      if (hasValue(data.surnames)) {
        html += `<div class="section-title">संबंधित आडनावे</div>`;
        html += `<div class="info-item"><span class="info-label">आडनावे:</span> <span class="info-value">${data.surnames}</span></div>`;
      }

      // Contact Information Section
      if (hasValue(data.phone) || hasValue(data.email) || hasValue(data.address) || customFields.contact.length > 0) {
        
        html += `<div class="section-title">संपर्क माहिती</div>`;
        html += buildInfoItems([
          { label: 'मोबाईल क्रमांक', value: data.phone },
          { label: 'ईमेल', value: data.email },
          { label: 'पत्ता', value: data.address, multiline: true }
        ]);
        
        // Add custom contact fields
        customFields.contact.forEach(field => {
          html += `<div class="info-item"><span class="info-label">${field.name}:</span> <span class="info-value">${field.value}</span></div>`;
        });
      }

      // Expectations Section
      if (hasValue(data.expectations) || hasValue(data.hobbies) || customFields.expectations.length > 0) {
        
        html += `<div class="section-title">अपेक्षा आणि आवडी</div>`;
        html += buildInfoItems([
          { label: 'वराच्या अपेक्षा', value: data.expectations, multiline: true },
          { label: 'आवडी/हौबी', value: data.hobbies, multiline: true }
        ]);
        
        // Add custom expectations fields
        customFields.expectations.forEach(field => {
          html += `<div class="info-item"><span class="info-label">${field.name}:</span> <span class="info-value">${field.value}</span></div>`;
        });
      }

      // Add watermark
      html += `<div class="watermark">
        <a href="https://creativebiodata.com" target="_blank">creativebiodata.com</a>
      </div>`;

      // Update the preview
      const previewElement = document.getElementById('biodata-preview');
      previewElement.innerHTML = html;
    }

    // Helper functions
    function hasValue(value) {
      return value && value.trim() !== '';
    }

    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB');
    }

    function formatTime(timeString) {
      if (!timeString) return '';
      const [hours, minutes] = timeString.split(':');
      const hour = parseInt(hours);
      const ampm = hour >= 12 ? 'PM' : 'AM';
      const formattedHour = hour % 12 || 12;
      return `${formattedHour}:${minutes} ${ampm}`;
    }

    function buildInfoItems(items) {
      let html = '';
      items.forEach(item => {
        if (hasValue(item.value)) {
          const formattedValue = item.format ? item.format(item.value) : item.value;
          if (item.multiline) {
            html += `<div class="info-item"><span class="info-label">${item.label}:</span> <span class="info-value">${formattedValue.replace(/\n/g, '<br>')}</span></div>`;
          } else {
            html += `<div class="info-item"><span class="info-label">${item.label}:</span> <span class="info-value">${formattedValue}</span></div>`;
          }
        }
      });
      return html;
    }

    function collectCustomFields(section) {
      const fields = [];
      const container = document.getElementById(`${section}-custom-fields`);
      const customFields = container.querySelectorAll('.custom-field');
      
      customFields.forEach(field => {
        const name = field.querySelector('.custom-field-name').value;
        const value = field.querySelector('.custom-field-value').value;
        
        if (hasValue(name) && hasValue(value)) {
          fields.push({ name, value });
        }
      });
      
      return fields;
    }

    function collectSiblings(type) {
      const siblings = [];
      const container = document.getElementById(`${type}-container`);
      const siblingElements = container.querySelectorAll('.sibling-item');
      
      siblingElements.forEach(element => {
        const name = element.querySelector(`.${type}-name`).value;
        const details = element.querySelector(`.${type}-details`).value;
        
        if (hasValue(name)) {
          siblings.push({ name, details });
        }
      });
      
      return siblings;
    }

    function collectRelatives(type) {
      const relatives = [];
      const container = document.getElementById(`${type}-container`);
      const relativeElements = container.querySelectorAll('.relative-item');
      
      relativeElements.forEach(element => {
        const name = element.querySelector(`.${type}-name`).value;
        const contact = element.querySelector(`.${type}-contact`).value;
        
        if (hasValue(name)) {
          relatives.push({ name, contact });
        }
      });
      
      return relatives;
    }

    // === EXPORT FUNCTIONS ===
    async function exportBiodata(format) {
      const preview = document.getElementById('biodata-preview');
      
      const isDark = document.body.classList.contains('dark-mode');
      const originalStyles = {
        backgroundColor: preview.style.backgroundColor,
        width: preview.style.width,
        height: preview.style.height,
        transform: preview.style.transform
      };

      // Set A4 dimensions for export
      preview.style.width = '210mm';
      preview.style.height = '297mm';
      preview.style.backgroundColor = isDark ? '#1e1e1e' : 'white';
      preview.style.transform = 'none'; // Remove mobile scaling for export

      try {
        // Use higher scale for better quality
        const canvas = await html2canvas(preview, { 
          scale: 3,
          backgroundColor: isDark ? '#1e1e1e' : 'white',
          useCORS: true,
          logging: false,
          width: 794,
          height: 1123,
          onclone: function(clonedDoc) {
            const clonedPreview = clonedDoc.getElementById('biodata-preview');
            clonedPreview.style.width = '210mm';
            clonedPreview.style.height = '297mm';
            clonedPreview.style.backgroundColor = isDark ? '#1e1e1e' : 'white';
            clonedPreview.style.transform = 'none';
          }
        });

        // Restore original styles
        preview.style.backgroundColor = originalStyles.backgroundColor;
        preview.style.width = originalStyles.width;
        preview.style.height = originalStyles.height;
        preview.style.transform = originalStyles.transform;

        if (format === 'pdf') {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgData = canvas.toDataURL('image/jpeg', 0.95);
          
          const pdfWidth = 210;
          const pdfHeight = 297;
          const imgWidth = canvas.width;
          const imgHeight = canvas.height;
          
          const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
          const imgWidthPdf = imgWidth * ratio;
          const imgHeightPdf = imgHeight * ratio;
          const x = (pdfWidth - imgWidthPdf) / 2;
          const y = (pdfHeight - imgHeightPdf) / 2;
          
          pdf.addImage(imgData, 'JPEG', x, y, imgWidthPdf, imgHeightPdf);
          pdf.save('marathi_marriage_biodata.pdf');
          showToast('PDF downloaded successfully!');
        } else {
          const link = document.createElement('a');
          link.download = 'marathi_marriage_biodata.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
          showToast('Image downloaded successfully!');
          return canvas.toDataURL('image/png');
        }
      } catch (error) {
        console.error('Export error:', error);
        showToast('Error generating file. Please try again.');
      }
    }

    // === SHARE ON WHATSAPP ===
    document.getElementById('share-whatsapp').addEventListener('click', async () => {
      showToast('Generating image for WhatsApp...');
      
      try {
        const preview = document.getElementById('biodata-preview');
        const isDark = document.body.classList.contains('dark-mode');
        const originalStyles = {
          backgroundColor: preview.style.backgroundColor,
          width: preview.style.width,
          height: preview.style.height,
          transform: preview.style.transform
        };

        // Set A4 dimensions for export
        preview.style.width = '210mm';
        preview.style.height = '297mm';
        preview.style.backgroundColor = isDark ? '#1e1e1e' : 'white';
        preview.style.transform = 'none'; // Remove mobile scaling for export

        // Use html2canvas to create the image
        const canvas = await html2canvas(preview, { 
          scale: 2,
          backgroundColor: isDark ? '#1e1e1e' : 'white',
          useCORS: true,
          logging: false,
          width: 794,
          height: 1123,
          onclone: function(clonedDoc) {
            const clonedPreview = clonedDoc.getElementById('biodata-preview');
            clonedPreview.style.width = '210mm';
            clonedPreview.style.height = '297mm';
            clonedPreview.style.backgroundColor = isDark ? '#1e1e1e' : 'white';
            clonedPreview.style.transform = 'none';
          }
        });

        // Restore original styles
        preview.style.backgroundColor = originalStyles.backgroundColor;
        preview.style.width = originalStyles.width;
        preview.style.height = originalStyles.height;
        preview.style.transform = originalStyles.transform;

        // Convert canvas to blob
        canvas.toBlob(function(blob) {
          // Create a temporary URL for the blob
          const url = URL.createObjectURL(blob);
          
          // Create a temporary link element
          const link = document.createElement('a');
          link.href = url;
          link.download = 'marathi_marriage_biodata.png';
          
          // Create a file object from the blob
          const file = new File([blob], 'marathi_marriage_biodata.png', { type: 'image/png' });
          
          // Get biodata details for caption
          const name = document.getElementById('name').value || 'Marriage Biodata';
          const caption = `Check out my marriage biodata created with creativebiodata.com\n\nName: ${name}\n\nCreated with: https://creativebiodata.com`;
          
          // Create a share data object
          const shareData = {
            files: [file],
            title: 'Marathi Marriage Biodata',
            text: caption
          };
          
          // Check if Web Share API is available and supports files
          if (navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData)
              .then(() => {
                showToast('Biodata shared successfully!');
                URL.revokeObjectURL(url);
              })
              .catch((error) => {
                console.error('Error sharing:', error);
                // Fallback: open WhatsApp with text
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(caption)}`;
                window.open(whatsappUrl, '_blank');
                showToast('WhatsApp opened! Please attach the downloaded image.');
              });
          } else {
            // Fallback for browsers that don't support Web Share API with files
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(caption)}`;
            window.open(whatsappUrl, '_blank');
            showToast('WhatsApp opened! Please attach the downloaded image.');
          }
        }, 'image/png');
      } catch (error) {
        console.error('Error generating image for WhatsApp:', error);
        showToast('Error generating image for WhatsApp. Please try downloading and sharing manually.');
      }
    });

    document.getElementById('download-image').addEventListener('click', () => exportBiodata('image'));
    document.getElementById('download-pdf').addEventListener('click', () => exportBiodata('pdf'));
  </script>
</body>
</html>